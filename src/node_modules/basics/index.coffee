State = require "state"
Collection = require "collection"
View = require "view"
d3 = require "d3"

Location = require "location"
Profile = require "profile"

module.exports = View.extend
	props:
		name: "string"
		label: "string"
		email: "string"
		picture: "string"
		phone: "string"
		website: "string"
		summary: "string"

	derived:
		mailto: deps: ["email"], fn: -> "mailto:#{@email}"

	children:
		location: Location
	collections:
		profiles: Collection.of Profile

	template: require "./template"
	bindings:
		name: hook: "name"
		label: hook: "label"
		email: hook: "email"
		mailto:
			hook: "email"
			type: "attribute"
			name: "href"
		picture:
			type: "attribute"
			name: "src"
			hook: "picture"
		phone: hook: "phone"
		website: hook: "website", type: (el, newVal, oldVal) ->
			d3.select(el).text newVal
				.attr "href", newVal
		summary: hook: "summary"
